실시간 동영상 스트리밍 사이트를 구현하려고 한다 수십만명 정도의 대규모 인원이 감당할수 있도록 하려고 한다 어느 설계가 적합한가


1. 유저 1:1 채널 1:n 방송 1:1 비디오 관계
유저당 여러개의 방송을 가질수 있으며 방송에 status(online|offline)가 있어서 한번에 하나의 방송밖에 하지 못한다.
방송이 끝나면 방송 상태는 offline이 되고 실제 비디오메타데이터(비디오 저장위치 등)를 담은 비디오를생성한다 
사용자가 새로운 방송을 시작하면 상태가 online인 방송이 생성된다
사용자는 한번에 상태가 online인 방송 1개만 가질수 있다 따라서 동시에 여러 방송 못한다
방송이 끝나면 방송에 1대1 조인되는 1개의 동영상이 생성된다.


2 .유저 1:1 채널 1:1 방송 그리고 유저 1:채널 1:n 비디오 관계
유저는 1개의 방송을 가진다. 방송에 status(online|offline)가 있다
방송이 끝나면 방송의 메타데이터(제목등)을 복사하여 비디오를 생성한다. 비디오엔 실제 동영상 저장위치가 저장된다 또 유저의 채널에 관계가 생긴다
즉 방송이 끝나면 방송상태가 offline이 되고 방송에 대한 메타데이터들을 담은 비디오를 생성한다. 이 비디오는 유저의 채널에 추가된다
따라서 방송이 끝나면 채널에 조인되는 1개의 비디오가 생성된다.


어느 설계가 적합한가


두 가지 설계 방식 모두 유효하지만, 수십만 명의 대규모 유저가 동시에 사용할 수 있는 시스템을 구축하려면 유저 1:채널 1:n 비디오 관계를 사용하는 두 번째 설계가 더 적합할 수 있습니다. 이유는 다음과 같습니다:

1. 스케일러빌리티
첫 번째 설계는 각 방송마다 1:1 관계로 유저와 방송을 연결하고, 방송이 끝난 후 동영상 메타데이터가 생성되지만, 이는 각 방송마다 비디오를 따로 저장해야 하므로, 수십만 명의 유저가 동시에 방송을 하거나 비디오를 업로드하는 상황에서 시스템 부하가 크게 증가할 수 있습니다.
두 번째 설계에서는 유저가 하나의 방송을 진행하고, 방송이 종료된 후 해당 방송에 대한 메타데이터만 비디오 형태로 생성되어 유저의 채널에 저장됩니다. 이 구조는 더 효율적이고 확장성이 뛰어납니다. 비디오 메타데이터만 저장하고 실제 비디오 파일은 별도의 시스템에서 관리할 수 있기 때문에, 비디오 파일 관리와 메타데이터 관리가 분리되어 부담을 분산시킬 수 있습니다.
2. 동영상 메타데이터 관리
첫 번째 설계에서는 각 방송에 대해 별도의 동영상 메타데이터가 생성되어야 하므로, 방송의 끝나고 난 뒤에 매번 메타데이터 생성과정이 필요합니다. 이는 많은 방송을 동시에 처리해야 할 경우 복잡성을 높이고, 메타데이터 관리 시스템에 부하를 줄 수 있습니다.
두 번째 설계에서는 방송이 종료된 후 그 방송에 대한 메타데이터만 비디오로 복사되어 유저의 채널에 추가되므로 메타데이터 관리가 더 간단하고 일관성 있습니다.
3. 유저 인터페이스 및 관리 용이성
첫 번째 설계에서는 각 유저가 방송을 여러 번 할 수 있지만, 매번 방송 상태를 online/offline으로 변경해야 하므로 관리가 복잡할 수 있습니다.
두 번째 설계는 유저가 한 번에 하나의 방송만 진행하고, 방송이 끝날 때마다 채널에 비디오가 추가되는 방식으로 관리가 더 직관적이고, 방송 후 비디오 메타데이터를 채널에 추가하는 방식이 유저와의 상호작용에서 더욱 간단하고 명확할 수 있습니다.
4. 확장성
두 번째 설계에서는 방송이 끝날 때마다 비디오 메타데이터만 채널에 추가되므로 데이터베이스에 저장되는 데이터가 훨씬 간단하고 확장성이 높습니다. 시스템이 커질수록 더 많은 유저와 방송이 동시에 처리되어야 하기 때문에, 비디오의 메타데이터를 분리하고 이를 관리하는 것이 더 유리합니다.
결론:
두 번째 설계인 유저 1:1 채널 1:1 방송 그리고 유저 1:채널 1:n 비디오 관계가 더 적합합니다. 이 방식은 시스템의 확장성, 효율성, 관리 용이성 측면에서 더 유리하며, 대규모 유저를 수용하는 데 더 효과적입니다.
