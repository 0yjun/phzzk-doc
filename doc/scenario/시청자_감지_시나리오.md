# 시청자 입장 및 퇴장 감지 시나리오

## 1. 스트리머가 방송을 시작한다  
- **(Web 서버 → WAS 서버)**  
  - 웹 서버는 사용자 인터페이스(UI)를 제공한다.  
  - WAS 서버는 방송 시작을 처리하고, 현재 시청자 수를 0으로 초기화하며 방송 정보를 기록한다.

## 2. 시청자가 방송 페이지에 접속한다  
- **(시청자 → Web 서버)**  
  - 시청자가 방송 페이지에 접속하면 웹 서버는 WebSocket 연결을 생성한다.

## 3. WebSocket 연결 후 입장 알림 전송  
- **(클라이언트 → WAS 서버)**  
  - WebSocket 연결이 성공하면, 클라이언트는 "입장" 이벤트를 서버로 전송한다.  
  - 클라이언트는 `join` 메시지를 서버에 전송한다.

## 4. 입장 이벤트 수신 및 대기  
- **(WAS 서버)**  
  - WAS 서버는 "입장" 이벤트를 수신하고, 현재 시청자 수를 0.5초의 지연 후에 1 증가시키기로 설정한다.  
  - 서버는 해당 시청자를 대기 목록에 추가한다.

## 5. 현재 시청자 수 집계  
- WAS 서버는 대기 목록에 있는 사용자들의 입장 이벤트를 주기적으로 확인하고, 일정 시간(예: 5초) 후에 현재 시청자 수를 1 증가시키며, 이를 모든 시청자에게 알린다.

## 6. 퇴장 감지 및 대기  
- **(클라이언트 → WAS 서버)**  
  - 사용자가 방송을 종료하면 `beforeunload` 이벤트를 통해 "퇴장" 메시지를 서버로 전송한다.

## 7. 퇴장 이벤트 수신 및 대기  
- **(WAS 서버)**  
  - WAS 서버는 "퇴장" 이벤트를 수신하고, 현재 시청자 수를 1 감소시키기로 설정한다.  
  - 서버는 해당 시청자를 대기 목록에 추가한다.

## 8. 현재 시청자 수 업데이트  
- WAS 서버는 대기 목록에 있는 사용자들의 퇴장 이벤트를 주기적으로 확인하고, 일정 시간(예: 5초) 후에 현재 시청자 수를 1 감소시키며, 이를 모든 시청자에게 알린다.

## 9. 모든 시청자에게 업데이트 전송  
- **(WAS 서버 → 모든 클라이언트)**  
  - 입장 및 퇴장 이벤트 후 업데이트된 현재 시청자 수를 모든 클라이언트에게 전송하여 실시간으로 시청자 수를 동기화한다.
